id: t10_full_constraints_time_energy_power
name: Full constraints; fill + power + heat + recharge + deliver
description: |
  Full brew with all constraints: open to fill at the sink (20°C), close to pour,
  power on, heat from cold, fetch the teabag, brew, move to the table — with a
  recharge in the kitchen mid-run.

meta:
  domain: kitchen
  enable_numeric: true
  enable_conditional: true
  enable_durations: true
  max_steps: 26
  time_limit: 20
  init_fluents:
    - ["battery-cap", ["r1"], 8]
    - ["energy", ["r1"], 4]
    - ["water-temp", ["heater"], 0.0]
  reward_shaping:
    mode: instant
    milestones:
      - {expr: "(has-water heater)", reward: 0.05, once: true}
      - {expr: "(powered heater)", reward: 0.05, once: true}
      - {expr: "(>= (water-temp heater) 80)", reward: 0.10, once: true}
      - {expr: "(>= (energy r1) 5)", reward: 0.05, once: true}
      - {expr: "(in leaf cup)", reward: 0.05, once: true}
      - {expr: "(has-hot-water cup)", reward: 0.10, once: true}
      - {expr: "(at r1 table)", reward: 0.05, once: true}
  clutter:
    budget: {min: 3, max: 7}
    items:
      - name: cable
        types: [movable]
        variants: [cable1, cable2]
        at: [kitchen]
        count: {min: 0, max: 2}
      - name: tray
        types: [movable]
        variants: [tray1, tray2]
        at: [table]
        count: {min: 0, max: 2}
      - name: sponge
        types: [movable]
        at: [kitchen]
        count: {min: 0, max: 2}

objects:
  r1: robot
  kitchen: location
  pantry: location
  table: location
  sink1:
    types: [container]
    variants: [sink1, basin]
  cup:
    types: [container]
    variants: [mug, cup, beaker, tumbler]
  heater:
    types: [container, appliance]
    variants: [kettle, boiler, samovar, urn]
  leaf:
    types: [movable]
    variants: [teabag, sachet]

static_facts:
  - (has-charger kitchen)
  - (adjacent kitchen pantry)
  - (adjacent pantry kitchen)
  - (adjacent kitchen table)
  - (adjacent table kitchen)
  - (openable heater)
  - (is-sink sink1)
  - (pour-in-needs-open heater)
  - (pour-out-needs-closed heater)

init:
  - (at r1 kitchen)
  - (obj-at heater kitchen)
  - (obj-at cup kitchen)
  - (obj-at leaf pantry)
  - (obj-at sink1 kitchen)
  - (clear-hand r1)

termination:
  - name: goal
    all:
      - "(tea-ready cup)"
      - "(at r1 table)"
    outcome: success
    reward: 1.0
  - name: spill_fail
    when: "(spilled cup)"
    outcome: spilled
    reward: -1.0

reference_plan:
  - (open r1 heater)
  - (fill-water r1 heater sink1)
  - (close r1 heater)
  - (power-on r1 heater)
  - (heat-kettle r1 heater 4)
  - (move r1 kitchen pantry)
  - (pick-up r1 leaf)
  - (move r1 pantry kitchen)
  - (recharge r1 kitchen)
  - (put-in r1 leaf cup)
  - (pour r1 heater cup)
  - (steep-tea r1 leaf cup)
  - (move r1 kitchen table)
