domain: kitchen
requirements: [":strips", ":typing"]  # engine toggles features; spec stays superset

types:
  - name: robot
  - name: location
  - name: object
  - name: container
    parent: object
  - name: appliance
    parent: object

predicates:
  - name: co-located
    args: [{name: x, type: object}, {name: y, type: object}]
    nl: "x and y share a location"

  - name: at
    args: [{name: r, type: robot}, {name: l, type: location}]
    nl: "{r} is at {l}"

  - name: obj-at
    args: [{name: o, type: object}, {name: l, type: location}]
    nl: "{o} is at {l}"

  - name: holding
    args: [{name: r, type: robot}, {name: o, type: object}]
    nl: "{r} is holding {o}"

  - name: clear-hand
    args: [{name: r, type: robot}]
    nl: "{r} has a free hand"

  - name: in
    args: [{name: o, type: object}, {name: c, type: container}]
    nl: "{o} is in {c}"

  - name: open
    args: [{name: c, type: container}]
    nl: "{c} is open"

  - name: powered
    args: [{name: a, type: appliance}]
    nl: "{a} is powered"

  - name: boiled
    args: [{name: a, type: appliance}]
    nl: "{a} has boiled water"

  - name: has-hot-water
    args: [{name: m, type: container}]
    nl: "{m} contains hot water"

  - name: tea-ready
    args: [{name: m, type: container}]
    nl: "Tea is ready in {m}"

  - name: spilled
    args: [{name: m, type: container}]
    nl: "There was a spill at {m}"

  - name: has-charger
    args: [{name: l, type: location}]
    static: true
    nl: "{l} has a charging station"

  - name: adjacent
    args: [{name: l1, type: location}, {name: l2, type: location}]
    static: true
    nl: "{l1} is adjacent to {l2}"

  - name: needs-open
    args: [{name: c, type: container}]
    static: true
    nl: "{c} requires opening to pour"

# ---------- Fluents (numeric state) ----------
fluents:
  - name: elapsed
    args: []
    nl: "Elapsed time"

  - name: total-cost
    args: []
    nl: "Accumulated cost"

  - name: energy
    args: [{name: r, type: robot}]
    nl: "Energy of {r}"

  - name: water-temp
    args: [{name: v, type: container}]
    nl: "Water temperature in {v}"

# ---------- Actions ----------
actions:

  - name: move
    params: [{r: robot}, {from: location}, {to: location}]
    pre: ["(at ?r ?from)", "(adjacent ?from ?to)"]
    add: ["(at ?r ?to)"]
    del: ["(at ?r ?from)"]
    num_pre: ["(>= (energy ?r) 1)"]
    num_eff: ["(decrease (energy ?r) 1)", "(increase (elapsed) 1)", "(cost (move ?r ?from ?to) 1)"]
    duration: 1.0

  - name: open
    params: [{r: robot}, {c: container}]
    pre: ["(co-located ?r ?c)", "(not (open ?c))"]
    add: ["(open ?c)"]
    num_eff: ["(increase (elapsed) 0.5)", "(cost (open ?c) 0.2)"]
    duration: 0.5

  - name: close
    params: [{r: robot}, {c: container}]
    pre: ["(co-located ?r ?c)", "(open ?c)"]
    del: ["(open ?c)"]
    num_eff: ["(increase (elapsed) 0.5)", "(cost (close ?c) 0.2)"]
    duration: 0.5

  - name: pick-up
    params: [{r: robot}, {o: object}]
    pre: ["(co-located ?r ?o)", "(clear-hand ?r)"]
    add: ["(holding ?r ?o)"]
    del: ["(obj-at ?o ?l)", "(clear-hand ?r)"]
    num_eff: ["(increase (elapsed) 0.5)", "(cost (pick-up ?o) 0.2)"]
    duration: 0.5


  - name: put-down
    params: [{r: robot}, {o: object}]
    pre: ["(holding ?r ?o)"]
    add: ["(obj-at ?o ?l)", "(clear-hand ?r)"]
    del: ["(holding ?r ?o)"]
    num_eff: ["(increase (elapsed) 0.5)", "(cost (put-down ?o) 0.2)"]
    duration: 0.5


  - name: put-in
    params: [{r: robot}, {o: object}, {c: container}]
    pre: ["(co-located ?r ?c)", "(holding ?r ?o)", "(open ?c)"]
    add: ["(in ?o ?c)", "(clear-hand ?r)"]
    del: ["(holding ?r ?o)", "(obj-at ?o ?l)"]
    num_eff: ["(increase (elapsed) 0.5)", "(cost (put-in ?o ?c) 0.3)"]
    duration: 0.5



  - name: take-out
    params: [{r: robot}, {o: object}, {c: container}]
    pre:
      - "(clear-hand ?r)"
      - "(co-located ?r ?c)"
      - "(in ?o ?c)"
      - "(open ?c)"
    add: ["(holding ?r ?o)"]
    del: ["(in ?o ?c)", "(clear-hand ?r)"]
    num_eff: ["(increase (elapsed) 0.5)", "(cost (take-out ?o ?c) 0.3)"]
    duration: 0.5

  - name: power-on
    params: [{r: robot}, {a: appliance}]
    pre: ["(co-located ?r ?a)", "(not (powered ?a))"]
    add: ["(powered ?a)"]
    num_eff: ["(increase (elapsed) 0.5)", "(cost (power-on ?a) 0.5)"]
    duration: 0.5

  - name: toggle-kettle
    params: [{r: robot}, {k: appliance}]
    pre: ["(co-located ?r ?k)", "(powered ?k)"]
    add: ["(boiled ?k)"]
    num_eff: ["(increase (water-temp ?k) 30)", "(increase (elapsed) 5)", "(cost (toggle-kettle ?k) 2)"]
    duration: 5.0

  - name: pour
    params: [{r: robot}, {k: container}, {m: container}]
    pre:
      - "(co-located ?r ?k)"
      - "(co-located ?r ?m)"
      - "(or (not (needs-open ?k)) (open ?k))"     # source may require open
    add: []
    del: []
    cond:
      # 1) SPILL: target requires open and is closed
      - when: ["(needs-open ?m)", "(not (open ?m))"]
        add: ["(spilled ?m)"]
        del: ["(has-hot-water ?m)"]                # defensive cleanup
        num_eff: []                                # no temp change on spill

      # 2) FILL: target OK (open OR doesn't require) AND source hot
      - when: ["(or (not (needs-open ?m)) (open ?m))", "(>= (water-temp ?k) 80)"]
        add: ["(has-hot-water ?m)"]
        del: []
        num_eff: ["(assign (water-temp ?m) 100)"]

    num_eff: ["(increase (elapsed) 1)", "(cost (pour ?k ?m) 0.5)"]
    duration: 1.0

  - name: steep-tea
    params: [{r: robot}, {tb: object}, {m: container}]
    pre: ["(co-located ?r ?m)", "(in ?tb ?m)"]
    add: ["(tea-ready ?m)"]
    num_pre: ["(>= (water-temp ?m) 80)"]
    num_eff: ["(increase (elapsed) 2)", "(cost (steep-tea ?m) 0.5)"]
    duration: 2.0

  - name: recharge               # still explicit; could be derived with an 'at-charger' predicate later
    params: [{r: robot}, {l: location}]
    pre: ["(at ?r ?l)", "(has-charger ?l)"]
    add: []
    num_eff: ["(increase (energy ?r) 5)", "(increase (elapsed) 2)", "(cost (recharge ?r ?l) 0.1)"]
    duration: 2.0
